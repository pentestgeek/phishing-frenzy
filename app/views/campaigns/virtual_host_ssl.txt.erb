<VirtualHost *:80>
    ServerName <%= @fqdn %>
    ServerAlias <%= @fqdn %>
    Redirect / https://<%= @fqdn %>/

<% if GlobalSettings.first.site_url.downcase.include?('https://') %>
    SSLProxyEngine On
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerExpire off
<% end %>

    ProxyPass /reports/image <%= GlobalSettings.first.site_url %>/site_delivery/tracking_image/<%= @campaign_id %>/
    ProxyPassReverse /reports/image <%= GlobalSettings.first.site_url %>/site_delivery/tracking_image/<%= @campaign_id %>/
</VirtualHost>

#<!--start <%= @campaign_id %>-->
<VirtualHost *:443>
    SSLEngine On

    <% if @ssl.find_by_function("SSLCertificateFile").filename.present? %>
    SSLCertificateFile <%= @ssl.find_by_function("SSLCertificateFile").filename.file.file %>
    <% end %>
    <% if @ssl.find_by_function("SSLCertificateKeyFile").filename.present? %>
    SSLCertificateKeyFile <%= @ssl.find_by_function("SSLCertificateKeyFile").filename.file.file %>
    <% end %>
    <% if @ssl.find_by_function("SSLCertificateChainFile").filename.present? %>
    SSLCertificateChainFile <%= @ssl.find_by_function("SSLCertificateChainFile").filename.file.file %>
    <% end %>

    ServerName <%= @fqdn %>
    ServerAlias <%= @fqdn %>
    DocumentRoot <%= @template_location %>
    DirectoryIndex <%= @directory_index %>
    CustomLog     <%= @approot %>/log/www-campaign-<%= @campaign_id %>-access.log combined
    ErrorLog      <%= @approot %>/log/www-campaign-<%= @campaign_id %>-error.log

<% if GlobalSettings.first.site_url.downcase.include?('https://') %>
    SSLProxyEngine On
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerExpire off
<% end %>

    ProxyRequests Off
    ProxyPreserveHost Off
    ProxyPass /reports/image <%= GlobalSettings.first.site_url %>/site_delivery/tracking_image/<%= @campaign_id %>/
    ProxyPassReverse /reports/image <%= GlobalSettings.first.site_url %>/site_delivery/tracking_image/<%= @campaign_id %>/
    ProxyPass / <%= GlobalSettings.first.site_url %>/site_delivery/view/<%= @campaign_id %>/
    ProxyPassReverse / <%= GlobalSettings.first.site_url %>/site_delivery/view/<%= @campaign_id %>/
</VirtualHost>
#<!--end <%= @campaign_id %>-->
